<!doctype html>
<html>
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta charset="utf-8" />
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
    <title>Script to generate patched go.jar for deserialization vulnerability</title>
    <link href="../../assets/images/favicon.ico" rel="shortcut icon" />
    <link href="../../assets/vendor/stylesheets/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="../../assets/vendor/javascripts/jquery/1.12.0/jquery.min.js"></script>
    <script src="../../assets/vendor/bootstrap-sass-3.3.6/assets/javascripts/bootstrap.min.js"></script>
    <script src="../../assets/vendor/javascripts/enquire/2.1.2/enquire.min.js"></script>
    <script src="../../assets/vendor/javascripts/masonry.pkgd.min.js"></script>
    <link href="../../assets/stylesheets/site.css" rel="stylesheet" />
    <script src="../../assets/javascripts/all.js"></script>
    <script src="../../assets/javascripts/main.js"></script>
    <link rel="alternate" type="application/atom+xml" title="GoCD blog feed" href="../../feed.xml" />
  </head>

  <body class="misc misc_generate-patched-jar-for-deserialization-vulnerability misc_generate-patched-jar-for-deserialization-vulnerability_index">
    <header class="top">
  <div class="container">
    <a class="logo" href="../../"><img src="../../assets/images/Go_logo.png" /></a>
    <nav class="mainnav">
      <ul class="level0">
        <li class="dropdown">
          <a href="../../features/">Features</a>
          <ul>
            <li><a href="../../plugins/">Plugins</a></li>
            <li><a href="../../roadmap/">Roadmap</a></li>
            <li><a href="../../subscribe/">Subscribe to updates</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="../../community/">Community</a>
          <ul>
            <li><a href="../../contribute/">Contribute</a></li>
            <li><a href="../../cla/">CLA</a></li>
            <li><a href="../../open-issues/">Open Issues</a></li>
            <li><a href="../../events/">Events</a></li>
            <li><a href="../../partners/">Partners</a></li>
          </ul>
        </li>
        <li><a href="../../blog/">Blog</a></li>
        <li class="dropdown">
          <a href="../../help/">Help</a>
          <ul>
            <li><a href="../../getting-started/part-1/">Getting started</a></li>
            <li><a href="../../download/">Download</a></li>
          </ul>
        </li>
      </ul>
    </nav>
    <button class="navbtn menu collapse">
    <span></span>
    </button>
  </div>
</header>
<span id="top"></span>

    <div class="container">
  <p>The patches mentioned on <a href="../../2015/11/09/deserialization-vulnerability-commons-collections">the blog post</a> about
the deserialization vulnerability were generated using this script, written by the GoCD Team. You can verify it yourself
and run it. The final checksums will not match because the process of zipping it will include timestamps.</p>

<pre><code>#!/bin/bash

backup_file="go.backup.$(date +%s).for-commons-collections-exploit.jar"
log_file="go.jar.for-commons-collections-exploit.log"

echo "Logs will be in: $log_file"
exec &gt;"$log_file" 2&gt;&amp;1

set -x -e -o pipefail
cd "$(dirname "$0")"

cp go.jar "$backup_file"
unzip -d go-jar go.jar

(cd go-jar/defaultFiles/; unzip -d cruise-war cruise.war)
zip -d go-jar/defaultFiles/cruise-war/WEB-INF/lib/commons-collections-3.1.jar \
    org/apache/commons/collections/functors/InvokerTransformer.class
(cd go-jar/defaultFiles/cruise-war; zip -f ../cruise.war WEB-INF/lib/commons-collections-3.1.jar)

(cd go-jar/defaultFiles/; unzip -d agent-jar agent.jar)
zip -d go-jar/defaultFiles/agent-jar/lib/commons-collections-3.2.jar \
    org/apache/commons/collections/functors/InvokerTransformer.class
(cd go-jar/defaultFiles/agent-jar; zip -f ../agent.jar lib/commons-collections-3.2.jar)

(cd go-jar; zip -f ../go.jar defaultFiles/cruise.war)
(cd go-jar; zip -f ../go.jar defaultFiles/agent.jar)

rm -rf go-jar

diff &lt;(unzip -lv go.jar) &lt;(unzip -lv "$backup_file") || true
</code></pre>

</div>

    <footer>
	<div class="join-community">
		<div class="container">
			<h3>Join our community</h3>
			<ul>
				<li>
					<a href="#">
						<i class="fa fa-user-plus"></i>
						join us
					</a>
				</li>
				<li>
					<a href="#">
						<i class="fa fa-wechat"></i>
						Talk to us
					</a>
				</li>
				<li>
					<a href="#">
						<i class="fa fa-binoculars"></i>
						watch us
					</a>
				</li>
				<li>
					<a href="#">
						<i class="fa fa-twitter"></i>
						follow us
					</a>
				</li>
			</ul>
		</div>
	</div>
	<div class="page-footer">
		<div class="container">
			<p class="help-us-improve">Make this place better, <a href="https://github.com/gocd/gocd.github.io">fork</a>
			it or <a href="https://github.com/gocd/gocd.github.io/issues">suggest</a> something.</p>
			<p>
				GoCD is an open-source project, sponsored by <a target="_blank" href="http://www.thoughtworks.com">ThoughtWorks Inc.</a>
				under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" title="Apache 2.0 License">Apache License, Version 2.0</a>
			</p>
		</div>
	</div>
</footer>
<a href="#top" class="back-top"><i class="fa fa-arrow-circle-up"></i></a>
  </body>
</html>
